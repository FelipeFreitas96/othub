export const FEATURES = {
    GameProtocolChecksum: 'GameProtocolChecksum',
    GameAccountNames: 'GameAccountNames',
    GameChallengeOnLogin: 'GameChallengeOnLogin',
    GamePenalityOnDeath: 'GamePenalityOnDeath',
    GameNameOnNpcTrade: 'GameNameOnNpcTrade',
    GameDoubleFreeCapacity: 'GameDoubleFreeCapacity',
    GameDoubleExperience: 'GameDoubleExperience',
    GameTotalCapacity: 'GameTotalCapacity',
    GameSkillsBase: 'GameSkillsBase',
    GamePlayerRegenerationTime: 'GamePlayerRegenerationTime',
    GameChannelPlayerList: 'GameChannelPlayerList',
    GamePlayerMounts: 'GamePlayerMounts',
    GameEnvironmentEffect: 'GameEnvironmentEffect',
    GameCreatureEmblems: 'GameCreatureEmblems',
    GameItemAnimationPhase: 'GameItemAnimationPhase',
    GameMagicEffectU16: 'GameMagicEffectU16',
    GamePlayerMarket: 'GamePlayerMarket',
    GameSpritesU32: 'GameSpritesU32',
    GameChargeableItems: 'GameChargeableItems',
    GameOfflineTrainingTime: 'GameOfflineTrainingTime',
    GamePurseSlot: 'GamePurseSlot',
    GameFormatCreatureName: 'GameFormatCreatureName',
    GameSpellList: 'GameSpellList',
    GameClientPing: 'GameClientPing',
    GameExtendedClientPing: 'GameExtendedClientPing',
    GameDoubleHealth: 'GameDoubleHealth',
    GameDoubleSkills: 'GameDoubleSkills',
    GameChangeMapAwareRange: 'GameChangeMapAwareRange',
    GameMapMovePosition: 'GameMapMovePosition',
    GameAttackSeq: 'GameAttackSeq',
    GameBlueNpcNameColor: 'GameBlueNpcNameColor',
    GameDiagonalAnimatedText: 'GameDiagonalAnimatedText',
    GameLoginPending: 'GameLoginPending',
    GameNewSpeedLaw: 'GameNewSpeedLaw',
    GameForceFirstAutoWalkStep: 'GameForceFirstAutoWalkStep',
    GameMinimapRemove: 'GameMinimapRemove',
    GameDoubleShopSellAmount: 'GameDoubleShopSellAmount',
    GameContainerPagination: 'GameContainerPagination',
    GameThingMarks: 'GameThingMarks',
    GameLooktypeU16: 'GameLooktypeU16',
    GamePlayerStamina: 'GamePlayerStamina',
    GamePlayerAddons: 'GamePlayerAddons',
    GameMessageStatements: 'GameMessageStatements',
    GameMessageLevel: 'GameMessageLevel',
    GameNewFluids: 'GameNewFluids',
    GamePlayerStateU16: 'GamePlayerStateU16',
    GameNewOutfitProtocol: 'GameNewOutfitProtocol',
    GamePVPMode: 'GamePVPMode',
    GameWritableDate: 'GameWritableDate',
    GameAdditionalVipInfo: 'GameAdditionalVipInfo',
    GameBaseSkillU16: 'GameBaseSkillU16',
    GameCreatureIcons: 'GameCreatureIcons',
    GameHideNpcNames: 'GameHideNpcNames',
    GameSpritesAlphaChannel: 'GameSpritesAlphaChannel',
    GamePremiumExpiration: 'GamePremiumExpiration',
    GameBrowseField: 'GameBrowseField',
    GameEnhancedAnimations: 'GameEnhancedAnimations',
    GameOGLInformation: 'GameOGLInformation',
    GameMessageSizeCheck: 'GameMessageSizeCheck',
    GamePreviewState: 'GamePreviewState',
    GameLoginPacketEncryption: 'GameLoginPacketEncryption',
    GameClientVersion: 'GameClientVersion',
    GameContentRevision: 'GameContentRevision',
    GameExperienceBonus: 'GameExperienceBonus',
    GameAuthenticator: 'GameAuthenticator',
    GameUnjustifiedPoints: 'GameUnjustifiedPoints',
    GameSessionKey: 'GameSessionKey',
    GameDeathType: 'GameDeathType',
    GameIdleAnimations: 'GameIdleAnimations',
    GameKeepUnawareTiles: 'GameKeepUnawareTiles',
    GameIngameStore: 'GameIngameStore',
    GameIngameStoreHighlights: 'GameIngameStoreHighlights',
    GameIngameStoreServiceType: 'GameIngameStoreServiceType',
    GameAdditionalSkills: 'GameAdditionalSkills',
    GameDistanceEffectU16: 'GameDistanceEffectU16',
    GameLevelU16: 'GameLevelU16',
    GameSoul: 'GameSoul',
    GameMapOldEffectRendering: 'GameMapOldEffectRendering',
    GameMapDontCorrectCorpse: 'GameMapDontCorrectCorpse',
    GamePrey: 'GamePrey',
    GameThingQuickLoot: 'GameThingQuickLoot',
    GameThingQuiver: 'GameThingQuiver',
    GameThingPodium: 'GameThingPodium',
    GameThingUpgradeClassification: 'GameThingUpgradeClassification',
    GameThingCounter: 'GameThingCounter',
    GameThingClock: 'GameThingClock',
    GameThingPodiumItemType: 'GameThingPodiumItemType',
    GameSequencedPackets: 'GameSequencedPackets',
    GameUshortSpell: 'GameUshortSpell',
    GameTournamentPackets: 'GameTournamentPackets',
    GameDynamicForgeVariables: 'GameDynamicForgeVariables',
    GameConcotions: 'GameConcotions',
    GameAnthem: 'GameAnthem',
    GameVipGroups: 'GameVipGroups',
    GameBosstiary: 'GameBosstiary',
    GameDoublePlayerGoodsMoney: 'GameDoublePlayerGoodsMoney',
    GameLoadSprInsteadProtobuf: 'GameLoadSprInsteadProtobuf',
    GameItemShader: 'GameItemShader',
    GameCreatureShader: 'GameCreatureShader',
    GameCreatureAttachedEffect: 'GameCreatureAttachedEffect',
    GameCountU16: 'GameCountU16',
    GameEffectU16: 'GameEffectU16',
    GameContainerTypes: 'GameContainerTypes',
    GameBosstiaryTracker: 'GameBosstiaryTracker',
    GamePlayerStateCounter: 'GamePlayerStateCounter',
    GameLeechAmount: 'GameLeechAmount',
    GameItemAugment: 'GameItemAugment',
    GameDynamicBugReporter: 'GameDynamicBugReporter',
    GameWrapKit: 'GameWrapKit',
    GameContainerFilter: 'GameContainerFilter',
    GameEnterGameShowAppearance: 'GameEnterGameShowAppearance',
    GameSmoothWalkElevation: 'GameSmoothWalkElevation',
    GameNegativeOffset: 'GameNegativeOffset',
    GameItemTooltipV8: 'GameItemTooltipV8',
    GameWingsAurasEffectsShader: 'GameWingsAurasEffectsShader',
    GameForgeConvergence: 'GameForgeConvergence',
    GameAllowCustomBotScripts: 'GameAllowCustomBotScripts',
    GameColorizedLootValue: 'GameColorizedLootValue',
    GameAllowPreWalk: 'GameAllowPreWalk',
    GamePlayerFamiliars: 'GamePlayerFamiliars',
    GameTileAddThingWithStackpos: 'GameTileAddThingWithStackpos',
    GameMapCache: 'GameMapCache',
    GameForgeSkillStats: 'GameForgeSkillStats',
    GameCharacterSkillStats: 'GameCharacterSkillStats',
    GameCreaturePaperdoll: 'GameCreaturePaperdoll',
    GameMultiSpr: 'GameMultiSpr',
    GameVocationMonk: 'GameVocationMonk',
}

const enabled = new Set()
let currentVersion = 860

export function enableFeature(feature) {
    enabled.add(feature)
}

export function disableFeature(feature) {
    enabled.delete(feature)
}

export function isFeatureEnabled(feature) {
    return enabled.has(feature)
}

export function resetFeatures() {
    enabled.clear()
}

export function getClientVersion() {
    return currentVersion
}

export function getEnabledFeatures() {
    return new Set(enabled)
}

function applyFeatures(version) {
    enableFeature(FEATURES.GameFormatCreatureName)
    enableFeature(FEATURES.GameAllowPreWalk)
    enableFeature(FEATURES.GameMapCache)

    if (version >= 750) {
        enableFeature(FEATURES.GameSoul)
    }

    if (version >= 760) {
        enableFeature(FEATURES.GameLevelU16)
    }

    if (version >= 770) {
        enableFeature(FEATURES.GameLooktypeU16)
        enableFeature(FEATURES.GameMessageStatements)
        enableFeature(FEATURES.GameLoginPacketEncryption)
    }

    if (version >= 780) {
        enableFeature(FEATURES.GamePlayerAddons)
        enableFeature(FEATURES.GamePlayerStamina)
        enableFeature(FEATURES.GameNewFluids)
        enableFeature(FEATURES.GameMessageLevel)
        enableFeature(FEATURES.GamePlayerStateU16)
        enableFeature(FEATURES.GameNewOutfitProtocol)
    }

    if (version >= 790) {
        enableFeature(FEATURES.GameWritableDate)
    }

    if (version >= 840) {
        enableFeature(FEATURES.GameProtocolChecksum)
        enableFeature(FEATURES.GameAccountNames)
        enableFeature(FEATURES.GameDoubleFreeCapacity)
    }

    if (version >= 841) {
        enableFeature(FEATURES.GameChallengeOnLogin)
        enableFeature(FEATURES.GameMessageSizeCheck)
        enableFeature(FEATURES.GameTileAddThingWithStackpos)
    }

    if (version >= 854) {
        enableFeature(FEATURES.GameCreatureEmblems)
    }

    if (version >= 860) {
        enableFeature(FEATURES.GameAttackSeq)
    }

    if (version >= 862) {
        enableFeature(FEATURES.GamePenalityOnDeath)
    }

    if (version >= 870) {
        enableFeature(FEATURES.GameDoubleExperience)
        enableFeature(FEATURES.GamePlayerMounts)
        enableFeature(FEATURES.GameSpellList)
    }

    if (version >= 910) {
        enableFeature(FEATURES.GameNameOnNpcTrade)
        enableFeature(FEATURES.GameTotalCapacity)
        enableFeature(FEATURES.GameSkillsBase)
        enableFeature(FEATURES.GamePlayerRegenerationTime)
        enableFeature(FEATURES.GameChannelPlayerList)
        enableFeature(FEATURES.GameEnvironmentEffect)
        enableFeature(FEATURES.GameItemAnimationPhase)
    }

    if (version >= 940) {
        enableFeature(FEATURES.GamePlayerMarket)
    }

    if (version >= 953) {
        enableFeature(FEATURES.GamePurseSlot)
        enableFeature(FEATURES.GameClientPing)
    }

    if (version >= 960) {
        enableFeature(FEATURES.GameSpritesU32)
        enableFeature(FEATURES.GameOfflineTrainingTime)
    }

    if (version >= 963) {
        enableFeature(FEATURES.GameAdditionalVipInfo)
    }

    if (version >= 972) {
        enableFeature(FEATURES.GameDoublePlayerGoodsMoney)
    }

    if (version >= 980) {
        enableFeature(FEATURES.GamePreviewState)
        enableFeature(FEATURES.GameClientVersion)
    }

    if (version >= 981) {
        enableFeature(FEATURES.GameLoginPending)
        enableFeature(FEATURES.GameNewSpeedLaw)
    }

    if (version >= 984) {
        enableFeature(FEATURES.GameContainerPagination)
        enableFeature(FEATURES.GameBrowseField)
    }

    if (version >= 1000) {
        enableFeature(FEATURES.GameThingMarks)
        enableFeature(FEATURES.GamePVPMode)
    }

    if (version >= 1035) {
        enableFeature(FEATURES.GameDoubleSkills)
        enableFeature(FEATURES.GameBaseSkillU16)
    }

    if (version >= 1036) {
        enableFeature(FEATURES.GameCreatureIcons)
        enableFeature(FEATURES.GameHideNpcNames)
    }

    if (version >= 1038) {
        enableFeature(FEATURES.GamePremiumExpiration)
    }

    if (version >= 1050) {
        enableFeature(FEATURES.GameEnhancedAnimations)
    }

    if (version >= 1053) {
        enableFeature(FEATURES.GameUnjustifiedPoints)
    }

    if (version >= 1054) {
        enableFeature(FEATURES.GameExperienceBonus)
    }

    if (version >= 1055) {
        enableFeature(FEATURES.GameDeathType)
    }

    if (version >= 1057) {
        enableFeature(FEATURES.GameIdleAnimations)
    }

    if (version >= 1061) {
        enableFeature(FEATURES.GameOGLInformation)
    }

    if (version >= 1071) {
        enableFeature(FEATURES.GameContentRevision)
    }

    if (version >= 1072) {
        enableFeature(FEATURES.GameAuthenticator)
    }

    if (version >= 1074) {
        enableFeature(FEATURES.GameSessionKey)
    }

    if (version >= 1080) {
        enableFeature(FEATURES.GameIngameStore)
    }

    if (version >= 1092) {
        enableFeature(FEATURES.GameIngameStoreServiceType)
    }

    if (version >= 1093) {
        enableFeature(FEATURES.GameIngameStoreHighlights)
    }

    if (version >= 1094) {
        enableFeature(FEATURES.GameAdditionalSkills)
        enableFeature(FEATURES.GameLeechAmount)
    }

    if (version >= 1100) {
        enableFeature(FEATURES.GamePrey)
    }

    if (version >= 1200) {
        enableFeature(FEATURES.GameColorizedLootValue)
        enableFeature(FEATURES.GameThingQuickLoot)
        enableFeature(FEATURES.GameTournamentPackets)
        enableFeature(FEATURES.GameVipGroups)
        enableFeature(FEATURES.GameEnterGameShowAppearance)
    }

    if (version >= 1260) {
        enableFeature(FEATURES.GameThingQuiver)
    }

    if (version >= 1264) {
        enableFeature(FEATURES.GameThingPodium)
    }

    if (version >= 1272) {
        enableFeature(FEATURES.GameThingUpgradeClassification)
    }

    if (version >= 1281) {
        enableFeature(FEATURES.GameForgeSkillStats)
        enableFeature(FEATURES.GamePlayerFamiliars)
        disableFeature(FEATURES.GameEnvironmentEffect)
        disableFeature(FEATURES.GameItemAnimationPhase)
    }

    if (version >= 1290) {
        enableFeature(FEATURES.GameSequencedPackets)
        enableFeature(FEATURES.GameBosstiary)
        enableFeature(FEATURES.GameThingClock)
        enableFeature(FEATURES.GameThingCounter)
        enableFeature(FEATURES.GameThingPodiumItemType)
        enableFeature(FEATURES.GameDoubleShopSellAmount)
    }

    if (version >= 1300) {
        enableFeature(FEATURES.GameDoubleHealth)
        enableFeature(FEATURES.GameUshortSpell)
        enableFeature(FEATURES.GameConcotions)
        enableFeature(FEATURES.GameAnthem)
    }

    if (version >= 1314) {
        disableFeature(FEATURES.GameTournamentPackets)
        enableFeature(FEATURES.GameDynamicForgeVariables)
    }

    if (version >= 1320) {
        enableFeature(FEATURES.GameEffectU16)
        enableFeature(FEATURES.GameContainerTypes)
        enableFeature(FEATURES.GameBosstiaryTracker)
        enableFeature(FEATURES.GamePlayerStateCounter)
        disableFeature(FEATURES.GameLeechAmount)
        enableFeature(FEATURES.GameItemAugment)
        enableFeature(FEATURES.GameDynamicBugReporter)
    }

    if (version >= 1321) {
        enableFeature(FEATURES.GameWrapKit)
        enableFeature(FEATURES.GameContainerFilter)
    }

    if (version >= 1332) {
        enableFeature(FEATURES.GameForgeConvergence)
    }

    if (version >= 1410) {
        disableFeature(FEATURES.GameAdditionalSkills)
        disableFeature(FEATURES.GameForgeSkillStats)
        enableFeature(FEATURES.GameCharacterSkillStats)
    }

    if (version >= 1500) {
        enableFeature(FEATURES.GameVocationMonk)
    }
}

export function setClientVersion(version) {
    const parsed = parseInt(version, 10)
    currentVersion = Number.isFinite(parsed) && parsed > 0 ? parsed : 860
    resetFeatures()
    applyFeatures(currentVersion)
    return currentVersion
}
